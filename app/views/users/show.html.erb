<% if current_user == @user %>
  <div class="clean-row">
    <h2>Add transaction</h2>
  </div>

  <%= form_for([@user, @transaction]) do |f| %>
    <div class="row">
      <% if @transaction.errors.any? %>
        <h4 class="error-header"><%= pluralize(@transaction.errors.count, "error") %> occurred!</h4>

        <ul class="error-list">
          <% @transaction.errors.full_messages.each do |msg| %>
            <li class="error-msg"><%= msg %></li>
          <% end %>
        </ul>
      <% end %>

      <div class="row-field">
        <%= f.label :payee, class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :email, class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :ministry, class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :quantity, "# of tickets", class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :payment_check, "Tickets paid for?", class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :deposit_check, "Money deposited?", class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :confirmation_number, "Confirmation #", class:"field-label" %>
      </div>
    </div>

    <div class="row">
      <div class="row-field">
        <%= f.text_field :payee, autofocus: true, class:"field-input" %>
      </div>

      <div class="row-field">
        <%= f.text_field :email, placeholder:"example@address.com", autofocus: true, class:"field-input" %>
      </div>

      <div class="row-field">
        <%= f.text_field :ministry, placeholder:"MEDG", autofocus: true, class:"field-input" %>
      </div>

      <div class="row-field">
        <%= f.number_field :quantity, placeholder:"2", autofocus: true, class:"field-input" %>
      </div>

      <div class="row-field" style="margin-top: 10px;">
        <%= f.check_box :payment_check, class:"field-input" %>
      </div>

      <div class="row-field" style="margin-top: 10px;">
        <%= f.check_box :deposit_check, class:"field-input" %>
      </div>

      <div class="row-field">
        <%= f.number_field :confirmation_number, class:"field-label", id:'no-arrows' %>
      </div>

      <%= f.hidden_field :user_id, value: @user.id %>

      <div class="button-wrap">
        <%= f.submit "SAVE", class:"submit" %>
      </div>
    </div>
  <% end %>
<% end %>

<div class="clean-row">
  <% if current_user != @user %>
    <h2 class="left-title"><%= @user.name.capitalize %>'s Current transactions</h2>
  <% else %>
    <h2 class="left-title">Current transactions <%= link_to '(Export to CSV)', user_url(@user, format: 'csv') %></h2>
  <% end %>
</div>

<% @transactions.each_with_index do |t, i| %>
  <div class="row">
    <h4 class="column" id="italic"><%= i + 1 %>)</h4>
    <p class="column"><b>Payee:</b> <%= t.payee %></p>
    <p class="column"><b>Email:</b> <%= t.email %></p>
    <p class="column"><b>Ministry:</b> <%= t.ministry %></p>
    <p class="column"><b>Quantity:</b> <%= t.quantity %></p>
    <p class="column"><b>$ owed:</b> <%= "#{'%.02f' % t.debt}" %></p>
    <p class="column">
      <b>Ticket #(s):</b>
      <% t.tickets.each do |ticket| %>
        <%= ticket.number %>/
      <% end %>
    </p>
    <p class="column" id="mixed-content">
      <b class="precise-position">Paid?:</b>
      <% if t.payment_check != 1 %>
        <span class="glyphicon glyphicon-remove" style="color: #b71c1c;"></span>
      <% else %>
        <span class="glyphicon glyphicon-ok" style="color: #F6AE1C;"></span>
      <% end %>
    </p>
    <p class="column" id="mixed-content">
      <b class="precise-position">Deposited?:</b>
      <% if t.deposit_check != 1 %>
        <span class="glyphicon glyphicon-remove" style="color: #b71c1c;"></span>
      <% else %>
        <span class="glyphicon glyphicon-ok" style="color: #F6AE1C;"></span>
      <% end %>
    </p>
    <p class="column" style="padding-bottom: 10px;">
      <b>Confirmation #:</b> <%= t.confirmation_number %>
    </p>

    <div class="column">
      <%= link_to edit_transaction_url(t), class:'row-link' do %>
        <span class='glyphicon glyphicon-edit'></span>
      <% end %>
    </div>

    <div class="column" id="end-column">
      <%= link_to user_transaction_url(user_id: current_user.id, id: t.id), method: :delete, data: { confirm: "PERMENANTLY delete transaction data?" }, class:'row-link' do %>
        <span class="glyphicon glyphicon-trash" id="red"></span>
      <% end %>
    </div>
  </div>
<% end %>

<div class="third">
  <p class='sub-header'>Total Cash Owed</p>
  <%= "$#{'%.02f' % @transactions.where.not(payment_check: true).sum(:debt)}" %>
</div>

<div class="third">
  <p class='sub-header'>Total Cash On Hand</p>
  <%= "$#{'%.02f' % @transactions.where(payment_check: true).sum(:debt)}" %>
</div>

<div class="third">
  <p class='sub-header'>Total Cash Deposited</p>
  <%= "$#{'%.02f' % @transactions.where(deposit_check: true).sum(:debt)}" %>
</div>
