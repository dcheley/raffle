<% if current_user == @user %>
  <div class="clean-row">
    <h2>Add transaction</h2>
  </div>

  <%= form_for([@user, @transaction]) do |f| %>
    <div class="row">
      <% if @transaction.errors.any? %>
        <h4 class="error-header"><%= pluralize(@transaction.errors.count, "error") %> occurred!</h4>

        <ul class="error-list">
          <% @transaction.errors.full_messages.each do |msg| %>
            <li class="error-msg"><%= msg %></li>
          <% end %>
        </ul>
      <% end %>

      <div class="row-field">
        <%= f.label :payee, class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :email, class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :ministry, class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :quantity, "# of tickets", class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :debt, "$ amount owed", class:"field-label" %>
      </div>

      <div class="row-field">
        <%= f.label :status, "Tickets paid for?", class:"field-label" %>
      </div>
    </div>

    <div class="row">
      <div class="row-field">
        <%= f.text_field :payee, placeholder:"Firstname Lastname", autofocus: true, class:"field-input" %>
      </div>

      <div class="row-field">
        <%= f.text_field :email, placeholder:"example@address.com", autofocus: true, class:"field-input" %>
      </div>

      <div class="row-field">
        <%= f.text_field :ministry, placeholder:"MEDG", autofocus: true, class:"field-input" %>
      </div>

      <div class="row-field">
        <%= f.number_field :quantity, placeholder:"2", autofocus: true, class:"field-input" %>
      </div>

      <div class="row-field">
        <%= f.number_field :debt, placeholder:"3.00", class:"field-input", step: 0.01 %>
      </div>

      <div class="row-field" style="margin-top: 10px;">
        <%= f.check_box :status, class:"field-input" %>
      </div>

      <%= f.hidden_field :user_id, value: @user.id %>

      <div class="button-wrap">
        <%= f.submit "ADD", class:"submit" %>
      </div>
    </div>
  <% end %>
<% end %>

<div class="clean-row">
  <% if current_user != @user %>
    <h2 class="left-title"><%= @user.name.capitalize %>'s Current transactions</h2>
  <% else %>
    <h2 class="left-title">Current transactions <%= link_to '(Export to CSV)', user_url(@user, format: 'csv') %></h2>
  <% end %>
</div>

<% @transactions.each_with_index do |t, i| %>
  <div class="row">
    <h4 class="column" id="italic">Transaction <%= i + 1 %></h4>
    <p class="column"><b>Payee:</b> <%= t.payee %></p>
    <p class="column"><b>Email:</b> <%= t.email %></p>
    <p class="column"><b>Ministry:</b> <%= t.ministry %></p>
    <p class="column"><b>Quantity:</b> <%= t.quantity %></p>
    <p class="column"><b>$ owed:</b> <%= t.debt %></p>
    <p class="column">
      <b>Ticket #(s):</b>
      <% t.tickets.each do |ticket| %>
        <%= ticket.number %>,
      <% end %>
    </p>
    <p class="column">
      <b>Status:</b>
      <% if t.status != 1 %>
        <span class="glyphicon glyphicon-remove" style="color: #b71c1c;"></span>
      <% else %>
        <span class="glyphicon glyphicon-ok" style="color: #F6AE1C;"></span>
      <% end %>
    </p>

    <div class="column" style="border-right: none;">
      <%= link_to 'Edit', edit_transaction_url(t), class:'row-link' %>
      <%= link_to user_transaction_url(user_id: current_user.id, id: t.id), method: :delete, data: { confirm: "You sure?" }, class:'row-link' do %>
        <span class="glyphicon glyphicon-trash" id="red"></span>
      <% end %>
    </div>
  </div>
<% end %>
